{"version":3,"sources":["webpack:///./src/views/LoginRequest.vue?7a40","webpack:///src/views/LoginRequest.vue","webpack:///./src/views/LoginRequest.vue?3e72","webpack:///./src/views/LoginRequest.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","title","authority","failed","_v","isWeb","signature","_e","uri","app","appProfile","username","size","_s","name","_f","website","type","disabled","loading","on","click","handleSubmit","to","query","redirect","$route","fullPath","handleReject","staticRenderFns","openExternal","window","require","shell","LoginRequestvue_type_script_lang_js_","data","showLoading","errorMessage","Object","utils","requestId","auth","isChrome","clientId","params","client_id","callback","redirect_uri","responseType","includes","response_type","state","scope","concat","computed","$store","account","hasAuthority","auths","posting","account_auths","map","indexOf","mounted","$router","push","replace","loadAppProfile","methods","objectSpread","vuex_esm","_loadAppProfile","asyncToGenerator","regeneratorRuntime","mark","_callee","accounts","wrap","_context","prev","next","client","database","getAccounts","sent","JSON","parse","json_metadata","profile","redirect_uris","e","console","log","stop","apply","arguments","_handleSubmit","_callee2","loginObj","signedMessageObj","_signedMessageObj$sig","token","_context2","signMessage","message","slicedToArray","signatures","stringify_default","encodeURIComponent","location","t0","error","views_LoginRequestvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__"],"mappings":"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","file":"js/login-request.de02b379.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[(_vm.showLoading)?_c('VueLoadingIndicator',{staticClass:\"overlay fixed big\"}):_c('div',[_c('Header',{attrs:{\"title\":(\"Log in request (\" + _vm.authority + \")\")}}),(!_vm.failed)?_c('div',{staticClass:\"p-4 after-header\"},[_c('div',{staticClass:\"container-sm mx-auto\"},[(_vm.isWeb && !_vm.failed && !_vm.signature)?_c('OpenExternal',{staticClass:\"hide-sm\",attrs:{\"uri\":_vm.uri}}):_vm._e(),(!_vm.failed && !_vm.signature)?_c('div',[_c('div',{staticClass:\"mb-4\"},[(_vm.app && _vm.appProfile)?_c('div',{staticClass:\"mb-4 text-center\"},[_c('Avatar',{attrs:{\"username\":_vm.app,\"size\":80}}),_c('div',{staticClass:\"mt-2\"},[(_vm.appProfile.name)?_c('h4',{staticClass:\"mb-0\"},[_vm._v(_vm._s(_vm.appProfile.name))]):_vm._e(),(_vm.appProfile.website)?_c('span',[_vm._v(_vm._s(_vm._f(\"parseUrl\")(_vm.appProfile.website)))]):_vm._e()])],1):_vm._e(),_c('p',[(_vm.app)?_c('span',[_vm._v(\"The app \"),_c('b',[_vm._v(_vm._s(_vm.app))])]):_c('span',[_vm._v(\"This site \")]),_vm._v(\"\\n              is requesting access to view your current account username.\\n            \")])]),_c('div',{staticClass:\"mb-4\"},[(!_vm.username)?_c('router-link',{staticClass:\"btn btn-large btn-blue mr-2 mb-2\",attrs:{\"to\":{ name: 'login', query: { redirect: this.$route.fullPath } }}},[_vm._v(\"\\n              Continue\\n            \")]):_c('button',{staticClass:\"btn btn-large btn-success mr-2 mb-2\",attrs:{\"type\":\"submit\",\"disabled\":_vm.loading},on:{\"click\":_vm.handleSubmit}},[_vm._v(\"\\n              Log in\\n            \")]),_c('button',{staticClass:\"btn btn-large mb-2\",on:{\"click\":_vm.handleReject}},[_vm._v(\"\\n              Cancel\\n            \")])],1)]):_vm._e()],1)]):_c('div',{staticClass:\"p-4 after-header\"},[_c('div',{staticClass:\"container-sm mx-auto flash flash-error mb-4\"},[_vm._v(\"\\n        Oops, something went wrong. The log in request URL provided is invalid.\\n      \")])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <VueLoadingIndicator v-if=\"showLoading\" class=\"overlay fixed big\" />\n    <div v-else>\n      <Header :title=\"`Log in request (${authority})`\" />\n      <div v-if=\"!failed\" class=\"p-4 after-header\">\n        <div class=\"container-sm mx-auto\">\n          <OpenExternal v-if=\"isWeb && !failed && !signature\" :uri=\"uri\" class=\"hide-sm\" />\n          <div v-if=\"!failed && !signature\">\n            <div class=\"mb-4\">\n              <div class=\"mb-4 text-center\" v-if=\"app && appProfile\">\n                <Avatar :username=\"app\" :size=\"80\" />\n                <div class=\"mt-2\">\n                  <h4 v-if=\"appProfile.name\" class=\"mb-0\">{{ appProfile.name }}</h4>\n                  <span v-if=\"appProfile.website\">{{ appProfile.website | parseUrl }}</span>\n                </div>\n              </div>\n              <p>\n                <span v-if=\"app\"\n                  >The app <b>{{ app }}</b></span\n                >\n                <span v-else>This site </span>\n                is requesting access to view your current account username.\n              </p>\n            </div>\n            <div class=\"mb-4\">\n              <router-link\n                :to=\"{ name: 'login', query: { redirect: this.$route.fullPath } }\"\n                class=\"btn btn-large btn-blue mr-2 mb-2\"\n                v-if=\"!username\"\n              >\n                Continue\n              </router-link>\n              <button\n                type=\"submit\"\n                class=\"btn btn-large btn-success mr-2 mb-2\"\n                :disabled=\"loading\"\n                @click=\"handleSubmit\"\n                v-else\n              >\n                Log in\n              </button>\n              <button class=\"btn btn-large mb-2\" @click=\"handleReject\">\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class=\"p-4 after-header\" v-else>\n        <div class=\"container-sm mx-auto flash flash-error mb-4\">\n          Oops, something went wrong. The log in request URL provided is invalid.\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapActions } from 'vuex';\nimport client from '@/helpers/client';\nimport {\n  isWeb,\n  isChromeExtension,\n  isElectron,\n  buildSearchParams,\n  signComplete,\n  isValidUrl,\n  REQUEST_ID_PARAM,\n  b64uEnc,\n} from '@/helpers/utils';\nimport { getAuthority } from '@/helpers/auth';\n\nlet openExternal = null;\nif (typeof window !== 'undefined' && window.require) {\n  // eslint-disable-next-line prefer-destructuring\n  openExternal = window.require('electron').shell.openExternal;\n}\n\nexport default {\n  data() {\n    return {\n      showLoading: false,\n      loading: false,\n      failed: false,\n      signature: null,\n      errorMessage: '',\n      isWeb: isWeb(),\n      requestId: this.$route.query[REQUEST_ID_PARAM],\n      authority: getAuthority(this.$route.query.authority, 'posting'),\n      isChrome: isChromeExtension(),\n      clientId: this.$route.params.clientId || this.$route.query.client_id,\n      app: null,\n      appProfile: {},\n      callback: this.$route.query.redirect_uri,\n      responseType: ['code', 'token'].includes(this.$route.query.response_type)\n        ? this.$route.query.response_type\n        : 'token',\n      state: this.$route.query.state,\n      scope: ['login', 'posting'].includes(this.$route.query.scope)\n        ? this.$route.query.scope\n        : 'login',\n      uri: `steem://login-request/${this.$route.params.clientId}${buildSearchParams(this.$route)}`,\n    };\n  },\n  computed: {\n    username() {\n      return this.$store.state.auth.username;\n    },\n    account() {\n      return this.$store.state.auth.account;\n    },\n    hasAuthority() {\n      const auths = this.account.posting.account_auths.map(auth => auth[0]);\n      return auths.indexOf(this.clientId) !== -1;\n    },\n  },\n  mounted() {\n    if (\n      this.scope === 'posting' &&\n      !isChromeExtension() &&\n      this.clientId &&\n      this.username &&\n      !this.hasAuthority\n    ) {\n      this.$router.push({\n        name: 'authorize',\n        params: { username: this.clientId },\n        query: { redirect_uri: this.uri.replace('steem:/', '') },\n      });\n    } else if (this.clientId) {\n      this.loadAppProfile();\n    }\n  },\n  methods: {\n    ...mapActions(['signMessage']),\n    async loadAppProfile() {\n      this.showLoading = true;\n      const app = this.clientId;\n      const accounts = await client.database.getAccounts([app]);\n      if (accounts[0]) {\n        this.app = app;\n        try {\n          this.appProfile = JSON.parse(accounts[0].json_metadata).profile;\n          if (\n            !isChromeExtension() &&\n            (!this.appProfile.redirect_uris.includes(this.callback) || !isValidUrl(this.callback))\n          ) {\n            this.failed = true;\n          }\n        } catch (e) {\n          console.log('Failed to parse app account', e);\n        }\n      } else {\n        this.failed = true;\n      }\n      this.showLoading = false;\n    },\n    async handleSubmit() {\n      this.loading = true;\n      this.showLoading = true;\n\n      try {\n        const loginObj = {};\n        loginObj.type = isChromeExtension() ? 'login' : this.scope;\n        if (this.responseType === 'code') loginObj.type = 'code';\n        if (this.app) loginObj.app = this.app;\n        const signedMessageObj = await this.signMessage({\n          message: loginObj,\n          authority: this.authority,\n        });\n        [this.signature] = signedMessageObj.signatures;\n        const token = b64uEnc(JSON.stringify(signedMessageObj));\n        if (this.requestId) {\n          signComplete(this.requestId, null, token);\n        }\n        if (!isChromeExtension()) {\n          let { callback } = this;\n          callback += this.responseType === 'code' ? `?code=${token}` : `?access_token=${token}`;\n          callback += `&username=${this.username}`;\n          if (this.responseType !== 'code') callback += '&expires_in=604800';\n          if (this.state) callback += `&state=${encodeURIComponent(this.state)}`;\n\n          if (isElectron()) {\n            openExternal(callback);\n            this.$router.push('/');\n          } else {\n            window.location = callback;\n          }\n        }\n      } catch (err) {\n        console.error('Failed to log in', err);\n        this.signature = '';\n        this.failed = true;\n        if (this.requestId) {\n          signComplete(this.requestId, err, null);\n        }\n        this.loading = false;\n      }\n    },\n    handleReject() {\n      const requestId = this.$route.query[REQUEST_ID_PARAM];\n      if (requestId) {\n        signComplete(requestId, 'Request canceled', null);\n      }\n      if (!isChromeExtension()) {\n        this.$router.push('/');\n      }\n    },\n  },\n};\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LoginRequest.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LoginRequest.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./LoginRequest.vue?vue&type=template&id=3e29cf12&\"\nimport script from \"./LoginRequest.vue?vue&type=script&lang=js&\"\nexport * from \"./LoginRequest.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}