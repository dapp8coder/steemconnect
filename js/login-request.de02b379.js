(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["login-request"],{"6c73":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.showLoading?s("VueLoadingIndicator",{staticClass:"overlay fixed big"}):s("div",[s("Header",{attrs:{title:"Log in request ("+e.authority+")"}}),e.failed?s("div",{staticClass:"p-4 after-header"},[s("div",{staticClass:"container-sm mx-auto flash flash-error mb-4"},[e._v("\n        Oops, something went wrong. The log in request URL provided is invalid.\n      ")])]):s("div",{staticClass:"p-4 after-header"},[s("div",{staticClass:"container-sm mx-auto"},[!e.isWeb||e.failed||e.signature?e._e():s("OpenExternal",{staticClass:"hide-sm",attrs:{uri:e.uri}}),e.failed||e.signature?e._e():s("div",[s("div",{staticClass:"mb-4"},[e.app&&e.appProfile?s("div",{staticClass:"mb-4 text-center"},[s("Avatar",{attrs:{username:e.app,size:80}}),s("div",{staticClass:"mt-2"},[e.appProfile.name?s("h4",{staticClass:"mb-0"},[e._v(e._s(e.appProfile.name))]):e._e(),e.appProfile.website?s("span",[e._v(e._s(e._f("parseUrl")(e.appProfile.website)))]):e._e()])],1):e._e(),s("p",[e.app?s("span",[e._v("The app "),s("b",[e._v(e._s(e.app))])]):s("span",[e._v("This site ")]),e._v("\n              is requesting access to view your current account username.\n            ")])]),s("div",{staticClass:"mb-4"},[e.username?s("button",{staticClass:"btn btn-large btn-success mr-2 mb-2",attrs:{type:"submit",disabled:e.loading},on:{click:e.handleSubmit}},[e._v("\n              Log in\n            ")]):s("router-link",{staticClass:"btn btn-large btn-blue mr-2 mb-2",attrs:{to:{name:"login",query:{redirect:this.$route.fullPath}}}},[e._v("\n              Continue\n            ")]),s("button",{staticClass:"btn btn-large mb-2",on:{click:e.handleReject}},[e._v("\n              Cancel\n            ")])],1)])],1)])],1)],1)},a=[],n=s("f499"),r=s.n(n),o=s("768b"),c=(s("96cf"),s("3b8d")),u=s("cebc"),l=(s("a481"),s("6762"),s("2fdb"),s("2f62")),h=s("451e"),p=s("a2b6"),d=s("40c1"),b=null;"undefined"!==typeof window&&window.require&&(b=window.require("electron").shell.openExternal);var m={data:function(){return{showLoading:!1,loading:!1,failed:!1,signature:null,errorMessage:"",isWeb:Object(p["k"])(),requestId:this.$route.query[p["a"]],authority:Object(d["b"])(this.$route.query.authority,"posting"),isChrome:Object(p["h"])(),clientId:this.$route.params.clientId||this.$route.query.client_id,app:null,appProfile:{},callback:this.$route.query.redirect_uri,responseType:["code","token"].includes(this.$route.query.response_type)?this.$route.query.response_type:"token",state:this.$route.query.state,scope:["login","posting"].includes(this.$route.query.scope)?this.$route.query.scope:"login",uri:"steem://login-request/".concat(this.$route.params.clientId).concat(Object(p["c"])(this.$route))}},computed:{username:function(){return this.$store.state.auth.username},account:function(){return this.$store.state.auth.account},hasAuthority:function(){var e=this.account.posting.account_auths.map(function(e){return e[0]});return-1!==e.indexOf(this.clientId)}},mounted:function(){"posting"===this.scope&&!Object(p["h"])()&&this.clientId&&this.username&&!this.hasAuthority?this.$router.push({name:"authorize",params:{username:this.clientId},query:{redirect_uri:this.uri.replace("steem:/","")}}):this.clientId&&this.loadAppProfile()},methods:Object(u["a"])({},Object(l["b"])(["signMessage"]),{loadAppProfile:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.showLoading=!0,t=this.clientId,e.next=4,h["a"].database.getAccounts([t]);case 4:if(s=e.sent,s[0]){this.app=t;try{this.appProfile=JSON.parse(s[0].json_metadata).profile,Object(p["h"])()||this.appProfile.redirect_uris.includes(this.callback)&&Object(p["j"])(this.callback)||(this.failed=!0)}catch(i){console.log("Failed to parse app account",i)}}else this.failed=!0;this.showLoading=!1;case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),handleSubmit:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,s,i,a,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,this.showLoading=!0,e.prev=2,t={},t.type=Object(p["h"])()?"login":this.scope,"code"===this.responseType&&(t.type="code"),this.app&&(t.app=this.app),e.next=9,this.signMessage({message:t,authority:this.authority});case 9:s=e.sent,i=Object(o["a"])(s.signatures,1),this.signature=i[0],a=Object(p["b"])(r()(s)),this.requestId&&Object(p["o"])(this.requestId,null,a),Object(p["h"])()||(n=this.callback,n+="code"===this.responseType?"?code=".concat(a):"?access_token=".concat(a),n+="&username=".concat(this.username),"code"!==this.responseType&&(n+="&expires_in=604800"),this.state&&(n+="&state=".concat(encodeURIComponent(this.state))),Object(p["i"])()?(b(n),this.$router.push("/")):window.location=n),e.next=24;break;case 17:e.prev=17,e.t0=e["catch"](2),console.error("Failed to log in",e.t0),this.signature="",this.failed=!0,this.requestId&&Object(p["o"])(this.requestId,e.t0,null),this.loading=!1;case 24:case"end":return e.stop()}},e,this,[[2,17]])}));function t(){return e.apply(this,arguments)}return t}(),handleReject:function(){var e=this.$route.query[p["a"]];e&&Object(p["o"])(e,"Request canceled",null),Object(p["h"])()||this.$router.push("/")}})},f=m,g=s("2877"),v=Object(g["a"])(f,i,a,!1,null,null,null);t["default"]=v.exports}}]);
//# sourceMappingURL=login-request.de02b379.js.map