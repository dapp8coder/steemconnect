{"version":3,"sources":["webpack:///./src/views/Sign.vue?b501","webpack:///src/views/Sign.vue","webpack:///./src/views/Sign.vue?c599","webpack:///./src/views/Sign.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","title","parsed","uriIsValid","staticClass","isWeb","failed","transactionId","_e","withChrome","uri","loading","error","id","_l","tx","operation","key","params","_v","_s","_f","callback","username","hasRequiredKey","authority","type","disabled","on","click","handleSubmit","no_broadcast","to","name","query","redirect","$route","fullPath","handleReject","staticRenderFns","Signvue_type_script_lang_js_","data","Object","utils","concat","pathMatch","requestId","auth","computed","$store","state","config","vestsToSP","settings","properties","mounted","parseUri","keys","methods","objectSpread","vuex_esm","lib","err","_handleSubmit","asyncToGenerator","regeneratorRuntime","mark","_callee","sig","signedTx","confirmation","_signedTx$signatures","wrap","_context","prev","next","client","sent","sign","slicedToArray","signatures","t0","console","abrupt","broadcast","result","t1","window","location","undefined","block","block_num","txn","txn_num","stop","apply","arguments","$router","push","views_Signvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__"],"mappings":"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","file":"js/sign.3d73d147.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('Header',{attrs:{\"title\":_vm.title}}),(_vm.parsed && _vm.uriIsValid)?_c('div',{staticClass:\"p-4 after-header\"},[_c('div',{staticClass:\"container-sm mx-auto\"},[(_vm.isWeb && !_vm.failed && !_vm.transactionId)?_c('OpenExternal',{staticClass:\"hide-sm\",attrs:{\"withChrome\":true,\"uri\":_vm.uri}}):_vm._e(),(!_vm.loading && _vm.failed)?_c('Error',{attrs:{\"error\":_vm.error}}):_vm._e(),(!_vm.loading && !!_vm.transactionId)?_c('Confirmation',{attrs:{\"id\":_vm.transactionId}}):_vm._e(),(!_vm.failed && !_vm.transactionId)?_c('div',[_vm._l((_vm.parsed.tx.operations),function(operation,key){return _c('Operation',{key:key,attrs:{\"operation\":operation}})}),(_vm.parsed.params.callback)?_c('div',{staticClass:\"flash flash-warn mb-4\"},[_vm._v(\"\\n          You are going to get redirected to\\n          \"),_c('span',{staticClass:\"link-color\"},[_vm._v(_vm._s(_vm._f(\"parseUrl\")(_vm.parsed.params.callback)))]),_vm._v(\".\\n        \")]):_vm._e(),(_vm.username && _vm.hasRequiredKey === false)?_c('div',{staticClass:\"flash flash-warn mb-4\"},[_vm._v(\"\\n          This transaction requires your \"),_c('b',[_vm._v(_vm._s(_vm.authority))]),_vm._v(\" key.\\n        \")]):_vm._e(),_c('div',{staticClass:\"mb-4\"},[(!_vm.username || _vm.hasRequiredKey === false)?_c('router-link',{staticClass:\"btn btn-large btn-blue mr-2 mb-2\",attrs:{\"to\":{ name: 'login', query: { redirect: this.$route.fullPath, authority: _vm.authority } }}},[_vm._v(\"\\n            Continue\\n          \")]):_c('button',{staticClass:\"btn btn-large btn-success mr-2 mb-2\",attrs:{\"type\":\"submit\",\"disabled\":_vm.loading},on:{\"click\":_vm.handleSubmit}},[_vm._v(\"\\n            \"+_vm._s(_vm.parsed.params.no_broadcast ? 'Sign' : 'Approve')+\"\\n          \")]),_c('button',{staticClass:\"btn btn-large mb-2\",on:{\"click\":_vm.handleReject}},[_vm._v(\"\\n            Cancel\\n          \")])],1)],2):_vm._e()],1)]):_c('div',{staticClass:\"p-4 after-header\"},[_c('div',{staticClass:\"container-sm mx-auto flash flash-error mb-4\"},[_vm._v(\"\\n      Oops, something went wrong. The signing URL provided is invalid.\\n    \")])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <Header :title=\"title\" />\n    <div v-if=\"parsed && uriIsValid\" class=\"p-4 after-header\">\n      <div class=\"container-sm mx-auto\">\n        <OpenExternal\n          v-if=\"isWeb && !failed && !transactionId\"\n          :withChrome=\"true\"\n          :uri=\"uri\"\n          class=\"hide-sm\"\n        />\n        <Error v-if=\"!loading && failed\" :error=\"error\" />\n        <Confirmation v-if=\"!loading && !!transactionId\" :id=\"transactionId\" />\n        <div v-if=\"!failed && !transactionId\">\n          <Operation\n            v-for=\"(operation, key) in parsed.tx.operations\"\n            :operation=\"operation\"\n            :key=\"key\"\n          />\n          <div class=\"flash flash-warn mb-4\" v-if=\"parsed.params.callback\">\n            You are going to get redirected to\n            <span class=\"link-color\">{{ parsed.params.callback | parseUrl }}</span\n            >.\n          </div>\n          <div class=\"flash flash-warn mb-4\" v-if=\"username && hasRequiredKey === false\">\n            This transaction requires your <b>{{ authority }}</b> key.\n          </div>\n          <div class=\"mb-4\">\n            <router-link\n              :to=\"{ name: 'login', query: { redirect: this.$route.fullPath, authority } }\"\n              class=\"btn btn-large btn-blue mr-2 mb-2\"\n              v-if=\"!username || hasRequiredKey === false\"\n            >\n              Continue\n            </router-link>\n            <button\n              type=\"submit\"\n              class=\"btn btn-large btn-success mr-2 mb-2\"\n              :disabled=\"loading\"\n              @click=\"handleSubmit\"\n              v-else\n            >\n              {{ parsed.params.no_broadcast ? 'Sign' : 'Approve' }}\n            </button>\n            <button class=\"btn btn-large mb-2\" @click=\"handleReject\">\n              Cancel\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"p-4 after-header\" v-else>\n      <div class=\"container-sm mx-auto flash flash-error mb-4\">\n        Oops, something went wrong. The signing URL provided is invalid.\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport * as steemuri from 'steem-uri';\nimport { mapActions } from 'vuex';\nimport { resolveTransaction } from '@/helpers/client';\nimport { getAuthority } from '@/helpers/auth';\nimport {\n  isWeb,\n  isChromeExtension,\n  getVestsToSP,\n  legacyUriToParsedSteemUri,\n  getLowestAuthorityRequired,\n  processTransaction,\n  buildSearchParams,\n  signComplete,\n  REQUEST_ID_PARAM,\n} from '@/helpers/utils';\n\nexport default {\n  data() {\n    return {\n      parsed: null,\n      uriIsValid: true,\n      loading: false,\n      transactionId: '',\n      failed: false,\n      error: false,\n      isWeb: isWeb(),\n      uri: `steem://sign/${this.$route.params.pathMatch}${buildSearchParams(this.$route)}`,\n      requestId: this.$route.query[REQUEST_ID_PARAM],\n      authority: getAuthority(this.$route.query.authority),\n      hasRequiredKey: null,\n    };\n  },\n  computed: {\n    title() {\n      let title = 'Confirm transaction';\n      if (this.authority) title += ` (${this.authority})`;\n      return title;\n    },\n    username() {\n      return this.$store.state.auth.username;\n    },\n    config() {\n      return {\n        vestsToSP: getVestsToSP(this.$store.state.settings.properties),\n      };\n    },\n  },\n  mounted() {\n    this.parseUri(this.uri);\n    if (!this.authority && this.parsed && this.parsed.tx) {\n      this.authority = getLowestAuthorityRequired(this.parsed.tx);\n      this.hasRequiredKey = !!(\n        this.$store.state.auth.username && this.$store.state.auth.keys[this.authority]\n      );\n    }\n  },\n  methods: {\n    ...mapActions(['sign', 'broadcast']),\n    parseUri(uri) {\n      let parsed;\n      try {\n        parsed = steemuri.decode(uri);\n      } catch (err) {\n        parsed = legacyUriToParsedSteemUri(uri);\n        if (!parsed) {\n          this.uriIsValid = false;\n        }\n      }\n      this.parsed = processTransaction(parsed, this.config);\n    },\n    async handleSubmit() {\n      this.loading = true;\n      let sig = null;\n      let tx = null;\n      let signedTx = null;\n      let confirmation = null;\n\n      try {\n        tx = await resolveTransaction(this.parsed, this.$store.state.auth.username);\n        signedTx = await this.sign({ tx, authority: this.authority });\n        [sig] = signedTx.signatures;\n      } catch (err) {\n        console.error('Failed to resolve and sign transaction', err);\n      }\n\n      if (!sig) {\n        this.transactionId = '';\n        this.failed = true;\n        this.loading = false;\n        return;\n      }\n\n      if (!this.parsed.params.no_broadcast) {\n        try {\n          confirmation = await this.broadcast(signedTx);\n          this.transactionId = confirmation.id;\n          this.failed = false;\n\n          if (this.requestId) {\n            signComplete(this.requestId, null, { result: confirmation });\n          }\n        } catch (err) {\n          this.error = err;\n          console.error('Failed to broadcast transaction', err);\n          this.transactionId = '';\n          this.failed = true;\n\n          if (this.requestId) {\n            signComplete(this.requestId, err, null);\n          }\n        }\n      }\n\n      // TODO: Handle Chrome extension & desktop app redirect.\n      if (confirmation && this.parsed.params.callback && isWeb()) {\n        window.location = steemuri.resolveCallback(this.parsed.params.callback, {\n          sig,\n          id: confirmation.id || undefined,\n          block: confirmation.block_num || undefined,\n          txn: confirmation.txn_num || undefined,\n        });\n      } else {\n        this.loading = false;\n      }\n    },\n    handleReject() {\n      if (this.requestId) {\n        signComplete(this.requestId, 'Request rejected', null);\n      }\n      if (!isChromeExtension()) {\n        this.$router.push('/');\n      }\n    },\n  },\n};\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Sign.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Sign.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Sign.vue?vue&type=template&id=183356ed&\"\nimport script from \"./Sign.vue?vue&type=script&lang=js&\"\nexport * from \"./Sign.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}